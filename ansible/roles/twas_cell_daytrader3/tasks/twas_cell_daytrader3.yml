---

- name: copy daytrader3.py.j2 template
  template:
   src: "daytrader3.py.j2"
   dest: "daytrader3.py"
- name: copy daytrader_vars.py.j2 template
  template:
   src: "daytrader_vars.py.j2"
   dest: "daytrader_vars.py"
- name: copy resource_scripts.py.j2 template
  template:
   src: "resource_scripts.py.j2"
   dest: "resource_scripts.py"
- name: copy daytrader app
  copy:
   src: "{{ DefaultEarFile }}"
   dest: "~/{{ DefaultEarFile }}"

- name: db2jars dir ${WAS_INSTALL_ROOT}/db2jars
  file:
    path: '{{ item }}'
    state: directory
    recurse: yes
  with_items:
  - "{{install_base }}/{{ twas_dir }}/db2jars"

- name: copy db2jcc4.jar  ${WAS_INSTALL_ROOT}/db2jars
  copy:
    src: /tmp/db2jcc4.jar
    dest: "{{install_base }}/{{ twas_dir }}/db2jars/db2jcc4.jar"
    mode: '0755'
- name: copy db2jcc_license_cu.jar ${WAS_INSTALL_ROOT}/db2jars
  copy:
    src: /tmp/db2jcc_license_cu.jar
    dest: "{{install_base }}/{{ twas_dir }}/db2jars/db2jcc_license_cu.jar"
    mode: '0755'

- name: run the daytrader3 setup jython script
  shell: "{{install_base }}/{{ twas_dir }}/profiles/{{ profile_name }}/bin/wsadmin.sh -lang jython -username {{ twas_username }} -password {{ twas_password }} -f daytrader3.py"
  register: daytrader3Output
  failed_when: ( daytrader3Output.rc not in [ 0, 255 ] )
- name: daytrader3Output
  debug:
   msg: "{{ daytrader3Output.stdout_lines }}"

