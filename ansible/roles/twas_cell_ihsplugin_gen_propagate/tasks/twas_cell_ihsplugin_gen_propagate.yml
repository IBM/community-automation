---

- name: Set targetappServerName for default
  ansible.builtin.set_fact:
    targetappServerName: "{{ appServerName }}"
  when: profile_type == 'default'

- name: Set targetappServerName for dmgr
  ansible.builtin.set_fact:
    targetappServerName: dmgr
  when: profile_type == 'dmgr'

- name: Copy ihsplugin_gen_propagate.py.j2 template
  ansible.builtin.template:
    src: "ihsplugin_gen_propagate.py.j2"
    dest: "ihsplugin_gen_propagate.py"

- name: Run the ihsplugin_gen_propagate jython script
  ansible.builtin.shell: "{{ install_base }}/{{ twas_dir }}/profiles/{{ profile_name }}/bin/wsadmin{{ ext }} -lang jython -username {{ twas_username }} -password {{ twas_password }} -f ihsplugin_gen_propagate.py"
  register: ihsplugin_gen_propagateOutput
  failed_when: ( ihsplugin_gen_propagateOutput.rc not in [ 0, 255 ] )
- name: Plugin ihsplugin_gen_propagateOutput
  ansible.builtin.debug:
    msg: "{{ ihsplugin_gen_propagateOutput.stdout_lines }}"


    # the wct configure plugin on windoze pretends to work , but actually fails, most likely due to path issues
    # manually configure the httpd.conf with:
    # LoadModule was_ap24_module c:/cygwin64/home/nest/Plugins/bin/64bits/mod_was_ap24_http.dll
    # WebSpherePluginConfig c:cygwin64/home/nest/Plugins/config/webserver1/plugin-cfg.xml

    # LoadModule was_ap24_module {{ cygwin }}{{ install_ihs_base }}/{{ plugin_dir }}/bin/64bits/mod_was_ap24_http.dll
    # WebSpherePluginConfig {{ cygwin }}{{ install_ihs_base }}/{{ plugin_dir }}/config/{{ webServerName }}/plugin-cfg.xml