---

- block:
  when: 'profile_type == "dmgr"'
  - name:  start the dmgr
    shell: "{{install_base }}/{{ twas_dir }}/profiles/{{ profile_name }}/bin/startManager.sh"
    register: startManager
    failed_when: ( startManager.rc not in [ 0, 255 ] )
  - name: startManagerOutput
    debug: 
     msg: "{{ listProfile.stdout_lines }}"

- block:
  when: 'profile_type == "managed"'
  - name:  addNode
    shell: "{{ install_base }}/{{ twas_dir }}/profiles/{{ profile_name }}/bin/addNode.sh {{ dmgr_hostname }} -conntype RMI -username {{ twas_username }} -password {{ twas_password }} -profileName {{ profile_name }}"
    register: addNodeOutput
    failed_when: ( addNodeOutput.rc not in [ 0, 1, 2 ] )
  - name: addNodeOutput
    debug: 
     msg: "{{ addNodeOutput.stdout_lines }}"


