---

- name: Windoze hack due to some path issues for propogate - copy
  when: ansible_system == 'Windows' or 'ansible_system is search('CYG')`
  block:
  - name: Remove any previous plugin-key* files
    file:
      path: "{{ install_ihs_base }}/{{ plugin_dir }}/config/{{ webServerName }}/{{ item }}"
      state: absent
    with_items:
    - plugin-key.sth
    - plugin-key.kdb
    - plugin-cfg.xml

  - name: Copy generated files
    copy:
      src: "{{ item }}"
      dest: "{{ install_ihs_base }}/{{ plugin_dir }}/config/{{ webServerName }}/{{ item }}"
      mode: '0755'
    with_items:
      - /tmp/plugin-cfg.xml
      - /tmp/plugin-key.sth
      - /tmp/plugin-key.kdb

  # the wct configure plugin on windoze pretends to work , but actually fails, most likely due to path issues
  # manually configure the httpd.conf with:

  - name: Insert/Update windoze WebSpherePluginConfig hack
    ansible.builtin.blockinfile:
      path: "{{ install_ihs_base }}/{{ http_dir }}/conf/httpd.conf"
      marker: "<!-- {mark} WebSpherePluginConfig ANSIBLE MANAGED BLOCK -->"
      block: |
        LoadModule was_ap24_module {{ cygwin }}{{ install_ihs_base }}/{{ plugin_dir }}/bin/64bits/mod_was_ap24_http.dll
        WebSpherePluginConfig {{ cygwin }}{{ install_ihs_base }}/{{ plugin_dir }}/config/{{ webServerName }}/plugin-cfg.xml




