<?xml version="1.0" encoding="UTF-8"?>
<server description="Penetration Testing server2">

    <!-- Enable features -->
    <featureManager>
      <feature>microProfile-6.1</feature>
      <feature>ldapRegistry-3.0</feature>		
      <feature>collectiveMember-1.0</feature>
      <feature>clusterMember-1.0</feature>
    </featureManager>

    <clusterMember name="pentCluster"/>

    <remoteFileAccess>
        <writeDir>${server.config.dir}</writeDir>
        <writeDir>${server.ouput.dir}/delete</writeDir>
    </remoteFileAccess>

    
         <!-- added 9/29/2021 to use custom cipher list to resolve LUCKY13 vulnerabilities -->
    <ssl id="defaultSSLConfig" securityLevel="CUSTOM" enabledCiphers="TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 TLS_RSA_WITH_AES_256_GCM_SHA384 TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384 TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384" />


    <basicRegistry id="basic" realm="PentestRealm">
        <user name="adminUser" password="notAPwd4Admin"/>
        <user name="readerUser" password="notAPwd4Reader"/>
        <user id="employeeUser" name="employeeUser" password="notAPwd4Employee"/>
        <user id="managerUser" name="managerUser" password="notAPwd4Manager"/>
        <group id="admins" name="admins">
          <member id="adminUser" name="adminUser"/>
        </group>
        <group id="readers" name="readers">
          <member id="readerUser" name="readerUser"/>
        </group>
        <group id="employees" name="employees">
          <member id="employeeUser" name="employeeUser"/>
        </group>
        <group id="managers" name="managers">
          <member id="managerUser" name="managerUser"/>
        </group>
    </basicRegistry>

    <administrator-role>
        <user>adminUser</user>
    </administrator-role>

    <reader-role>
        <user>readerUser</user>
    </reader-role>

    <!-- To access this server from a remote client add a host attribute to the following element, e.g. host="*" -->
		<!--OLD, before changing for Host Header Injection <httpEndpoint host="*" id="defaultHttpEndpoint" httpPort="9081" httpsPort="9444"/> -->
   <httpEndpoint id="defaultHttpEndpoint"
	         host="*"		
                 httpPort="9080"
	         httpsPort="9443" 
	         headersRef="xFrameHeaderID"/>

   <virtualHost id="default_host" >
            <hostAlias>${env.HOST_ALIAS}:9080</hostAlias>
            <hostAlias>${env.HOST_ALIAS}:9443</hostAlias>
   </virtualHost>

   <!-- Added 09/12/2022 to handle X-Frame-Options Header -->
   <headers id="xFrameHeaderID">
	  <setIfMissing>X-Frame-Options:SAMEORIGIN</setIfMissing>
   </headers>


    <!--updated 8/01/2022-->
    <httpSession cookieSecure="true" cookieName="PTSESSID2" sslTrackingEnabled="true" invalidateOnUnauthorizedSessionRequestException="true"/>


    <!-- 1/19/2022 added to disable welcome page and avoid / context root access -->
    <httpDispatcher enableWelcomePage="false" />

    <!-- added addstricttransportsecurityheader to fix RTC 284528 --> 
    <webContainer disableXPoweredBy="true" addstricttransportsecurityheader="max-age=31536000;includeSubDomains"/>

    <!-- Added 08/31/2022 to handle User Controllable URL Redirection -->
    <webAppSecurity ssoRequiresSSL="true" trackLoggedOutSSOCookies="true" sameSiteCookie="Strict" wasReqURLRedirectDomainNames="ibm.com" />

    <!-- Automatically expand WAR files and EAR files --> 
    <applicationManager autoExpand="true"/> 


 
  <logging maxFileSize="100" maxFiles="20" traceSpecification="*=info:com.ibm.ws.security.*=all:com.ibm.ws.webcontainer.security.*=all"/>

  <include location="${server.config.dir}/collectiveMember.xml" />

</server>
