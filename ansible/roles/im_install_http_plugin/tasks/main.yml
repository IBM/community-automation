---
### "ansible_architecture": "s390x",
### "ansible_architecture": "ppc64le",
### "ansible_architecture": "x86_64",
### "ansible_architecture": "chrp", --- AIX

#uninstall all
#IBM/InstallationManager/eclipse/tools/imcl uninstallAll

#clear install dirs
#rm -rf 

#install
#IBM/InstallationManager/eclipse/tools/imcl input ./im_http_plugin.xml -acceptLicense -secureStorageFile /home/nest/IBM/secureStorageFile.store

- name: check if imcl installed as a prereq
  stat:
    path: "{{ install_base }}/IBM/InstallationManager/eclipse/tools/imcl"
  register: isimcl
  failed_when: isimcl.stat.exists == False

- name: copy ihs_plugin.xml template
  template:
   src: im_http_plugin.xml.j2
   dest: "im_http_plugin.xml"

- name:  uninstallAll
  shell: "{{ install_base }}/IBM/InstallationManager/eclipse/tools/imcl uninstallAll"
  register: uninstallAllOutput
    
- name: uninstallAllOutput
  debug: 
   msg: "{{ uninstallAllOutput.stdout_lines }}"

- name:  clear http dir
  shell: "rm -rf {{ install_base }}/{{ http_dir }}"
- name:  clear plugins dir
  shell: "rm -rf {{ install_base }}/{{ plugin_dir }}"

- name:  generate secureStorageFile.store
  shell: "{{install_base }}/IBM/InstallationManager/eclipse/tools/imutilsc saveCredential -url https://rtpgsa.ibm.com -userName {{ gsa_user }} -userPassword {{ gsa_pass }} -secureStorageFile {{ install_base }}/secureStorageFile.store"

- name:  install http and plugins
  shell: "{{install_base }}/IBM/InstallationManager/eclipse/tools/imcl input ./im_http_plugin.xml -acceptLicense -secureStorageFile {{ install_base }}/IBM/secureStorageFile.store"
  register: installOutput

- name: installOutput
  debug: 
   msg: "{{ installOutput.stdout_lines }}"

- name:  listInstalledPackages
  shell: "{{install_base }}/IBM/InstallationManager/eclipse/tools/imcl listInstalledPackages"
  register: packageOutput

- name: packageOutput
  debug: 
   msg: "{{ packageOutput.stdout_lines }}"
